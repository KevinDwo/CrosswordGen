<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gaming Kreuzworträtsel</title>
    <style>
        /* Grundlegende Stildefinitionen für den Body */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f4f8;
            margin: 0;
            padding: 2rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
        }

        /* Stil für den Haupttitel */
        h1 {
            text-align: center;
            margin-bottom: 2rem;
            color: #1a202c;
            font-size: 2.5rem;
        }

        /* Stil für den Container, der das 12x12 Raster bildet */
        .container {
            display: grid;
            grid-template-columns: repeat(12, 40px);
            grid-template-rows: repeat(12, 40px);
            /* gap und background-color entfernt für eine robustere Border-Lösung */
            border: 2px solid #000;   /* Behält den dicken, schwarzen Außenrand bei */
        }

        /* Stil für jede einzelne Zelle im Raster */
        .cell {
            position: relative;
            width: 40px;
            height: 40px;
            box-sizing: border-box;
            background-color: #fff;
            /* Fügt einen Rand oben und links zu jeder Zelle hinzu */
            border-top: 1px solid #000; /* Farbe auf Schwarz geändert */
            border-left: 1px solid #000; /* Farbe auf Schwarz geändert */
        }
        
        /* Entfernt den überflüssigen inneren Rand der ersten Spalte */
        .cell:nth-child(12n + 1) {
            border-left: none;
        }

        /* Entfernt den überflüssigen inneren Rand der ersten Reihe */
        .cell:nth-child(-n + 12) {
            border-top: none;
        }


        /* Stil für das Eingabefeld in jeder Zelle */
        .cell input {
            width: 100%;
            height: 100%;
            border: none;
            text-align: center;
            font-size: 1.5rem;
            text-transform: uppercase;
            background: transparent;
            outline: none;
            color: #1a202c;
            padding: 0;
        }

        /* Stil für die Hinweiszellen (hellblau) mit Unicode-Pfeilen */
        .hint-cell {
            background-color: #cce7f5;
            display: flex;
            align-items: center;
            justify-content: center;
            /* Stile für die Unicode-Pfeil-Symbole */
            font-size: 2rem;      /* Macht den Pfeil größer */
            line-height: 1;       /* Stellt eine saubere vertikale Ausrichtung sicher */
            color: #1a202c;
            user-select: none;    /* Verhindert, dass der Pfeil markiert werden kann */
        }

    </style>
</head>
<body>

    <h1>Kreuzworträtsel</h1>

    <div class="container"></div>

    <script>
        // --- TEIL 1: GRUNDGERÜST ERSTELLEN ---
        const container = document.querySelector('.container');
        const totalCells = 144; // 12x12 Raster
        const gridWidth = 12;
        const regex = /^[a-zA-Z]?$/; // Erlaubt nur Buchstaben von A-Z

        // Erstelle alle 144 Zellen mit Eingabefeldern
        for(let i = 0; i < totalCells; i++) {
            const cell = document.createElement('div');
            cell.classList.add('cell');
            const input = document.createElement('input');
            input.setAttribute('maxlength', '1');
            cell.appendChild(input);
            container.appendChild(cell);
        }

        // Füge Event-Listener für die Eingabevalidierung hinzu
        document.querySelectorAll('.container input').forEach(input => {
            input.addEventListener('input', (e) => {
                if (!regex.test(e.target.value)) {
                    e.target.value = ''; // Setzt ungültige Eingabe zurück
                } else {
                    e.target.value = e.target.value.toUpperCase();
                }
            });
        });

        // --- TEIL 2: LAYOUT AUS API LADEN UND ANWENDEN (MIT 6 PFEILTYPEN) ---
        const apiUrl = 'http://127.0.0.1:5000/api/layout';
        const allCells = document.querySelectorAll('.container .cell');

        fetch(apiUrl)
            .then(response => {
                if (!response.ok) throw new Error(`HTTP Fehler! Status: ${response.status}`);
                return response.json();
            })
            .then(spots => {
                spots.forEach(spot => {
                    const hintIndex = spot.row * gridWidth + spot.col;

                    if (hintIndex >= 0 && hintIndex < totalCells) {
                        const hintCell = allCells[hintIndex];
                        hintCell.classList.add('hint-cell');

                        let arrowChar = '';
                        // Wähle das korrekte Unicode-Symbol basierend auf der Richtung
                        switch (spot.direction.toUpperCase()) {
                            case 'RIGHTLEFT':
                                arrowChar = '→';
                                break;
                            case 'RIGHTABOVE':
                                arrowChar = '↳';
                                break;
                            case 'RIGHTDOWN':
                                arrowChar = '↱';
                                break;
                            case 'DOWNLEFT':
                                arrowChar = '⬎';
                                break;
                            case 'DOWNABOVE':
                                arrowChar = '↓';
                                break;
                            case 'DOWNRIGHT':
                                arrowChar = '⬐';
                                break;
                        }
                        // Setze das Pfeil-Symbol als Inhalt der Zelle
                        hintCell.innerHTML = arrowChar;
                    }
                });
            })
            .catch(error => {
                console.error('Fehler beim Laden oder Verarbeiten des Layouts:', error);
                const errorDiv = document.createElement('div');
                errorDiv.style.color = 'red';
                errorDiv.style.marginTop = '1rem';
                errorDiv.textContent = 'Das Rätsel-Layout konnte nicht geladen werden. Bitte stelle sicher, dass der lokale Server läuft.';
                document.body.appendChild(errorDiv);
            });
    </script>
</body>
</html>
